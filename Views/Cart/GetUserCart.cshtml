

@model ShoppingCart
@{
    ViewData["Title"] = "My Cart";
}

<div class="container py-4">
    @if (Model != null && Model.CartDetails != null && Model.CartDetails.Count > 0)
    {


        <div class="card shadow-lg border-0 rounded-3">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h3 class="mb-0"><i class="bi bi-cart-fill me-2"></i> My Shopping Cart</h3>
                <span class="badge bg-light text-dark fs-6">
                    @Model.CartDetails.Count items
                </span>
            </div>

            <div class="card-body">
                <div class="table-responsive">
                    <table class="table align-middle table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Book</th>
                                <th>Image</th>
                                <th>Genre</th>
                                <th>Unit Price</th>
                                <th>Quantity</th>
                                <th>Total Price</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.CartDetails)
                            {
                                <tr>
                                    <td class="fw-semibold">@item.Book.BookName</td>
                                    <td>
                                        <img src="@(string.IsNullOrEmpty(item.Book.Image) ? "/css/images/noImage.jfif" : item.Book.Image)"
                                             class="rounded shadow-sm"
                                             style="width:60px;height:auto;"
                                             alt="@item.Book.BookName" />
                                    </td>
                                    <td>@item.Book.Genre.GenreName</td>
                                    <td>@item.Book.Price.ToString("C")</td>
                                    <td>@item.Quantity</td>
                                    <td class="fw-bold text-success">
                                        @((item.Book.Price * item.Quantity).ToString("C"))
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-success add-item me-1" data-id="@item.BookId" title="Add one more">
                                            <i class="bi bi-plus-lg"></i> 
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger remove-item" data-id="@item.BookId" title="Remove one">
                                             <i class="bi bi-dash-lg"></i> 
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="d-flex justify-content-between align-items-center border-top pt-3 mt-3">
                    <h5 class="fw-bold">
                        Total:
                        <span class="text-primary">
                            @(Model.CartDetails.Select(item => item.Book.Price * item.Quantity).Sum().ToString("C"))
                        </span>
                    </h5>

                    <a class="btn btn-lg btn-success shadow-sm" href="/Cart/Checkout">
                        <i class="bi bi-credit-card me-2"></i> Proceed to Checkout
                    </a>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <i class="bi bi-cart-x fs-1 text-muted"></i>
            <h2 class="mt-3">Your cart is empty</h2>
            <p><a class="btn btn-outline-primary mt-2" href="/Home/Index">Continue Shopping</a></p>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.querySelectorAll(".add-item").forEach(btn => {
            btn.addEventListener("click", async () => {
                const bookId = btn.getAttribute("data-id");
                await fetch(`/Cart/AddItem?bookId=${bookId}`, { method: "POST" });
                location.reload();
            });
        });

        document.querySelectorAll(".remove-item").forEach(btn => {
            btn.addEventListener("click", async () => {
                const bookId = btn.getAttribute("data-id");
                await fetch(`/Cart/RemoveItem?bookId=${bookId}`, { method: "POST" });
                location.reload();
            });
        });
    </script>
}

